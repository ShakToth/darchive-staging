# Pentest-Guide für Dämmerhafen (Einsteiger)

Dieses Verzeichnis enthält einen einfachen **Smoke-Pentest**, der die häufigsten Web-Sicherheitsrisiken in deiner App automatisch gegen eine laufende Instanz prüft.

## Was wird getestet?

`run_pentests.sh` prüft u. a.:

1. **Direkter Zugriffsschutz** auf interne Dateien (`functions.php`, `api/index.php`)
2. **Sicherheits-Header** (z. B. `X-Frame-Options`, `X-Content-Type-Options`)
3. **Session-Cookie-Flags** (`HttpOnly`, `SameSite`, `Secure`)
4. **CSRF-Schutz** bei API-POST-Endpunkten
5. Grober **Auth-/Validierungs-Sanity-Check** am Login

> Hinweis: Das sind bewusst schnelle, reproduzierbare Checks. Für tiefere Pentests (z. B. Burp Suite, SQLMap, Auth-Bypass) brauchst du zusätzliche manuelle Tests.

---

## So führst du die Pentests aus

### 1) Lokalen PHP-Server starten

Im Projekt-Root:

```bash
php -S 0.0.0.0:8000
```

Lass dieses Terminal offen.

### 2) In einem zweiten Terminal die Tests starten

```bash
./tools/pentest/run_pentests.sh
```

Optional mit eigener URL (z. B. Testserver):

```bash
./tools/pentest/run_pentests.sh https://deine-domain.tld
```

Für deine Live-Seite direkt:

```bash
./tools/pentest/run_pentests.sh https://xn--dmmerhafen-q5a.de/
```

Wenn sich dein Fenster zu schnell schließt (z. B. beim Doppelklick), nutze Pause + Report:

```bash
./tools/pentest/run_pentests.sh https://xn--dmmerhafen-q5a.de/ --pause --report=tools/pentest/latest-report.txt
```

Dann bleibt die Ausgabe offen und wird zusätzlich in `tools/pentest/latest-report.txt` gespeichert.

### 2b) Windows-Start per Doppelklick

Es gibt jetzt auch `tools/pentest/run_pentests_windows.bat`.

- Doppelklick startet den Test (Standard: `https://xn--dmmerhafen-q5a.de/`)
- Das Fenster bleibt offen (`pause`)
- Ergebnis wird nach `tools/pentest/latest-report.txt` geschrieben

### 3) Ergebnis lesen

- `[PASS]` = Test bestanden
- `[WARN]` = kein direkter Exploit, aber Verbesserung empfohlen
- `[FAIL]` = potenzielles Sicherheitsproblem, sollte behoben werden

Wenn `FAIL > 0`, beendet sich das Script mit Exit-Code `1` (praktisch für CI).

---

## Typische nächste Schritte bei Findings

- **CSP fehlt** → `Content-Security-Policy` ergänzen (XSS-Härtung)
- **Cookie ohne Secure** → auf HTTPS unbedingt `session.cookie_secure=1`
- **CSRF-Test failt** → Endpunkt auf `validateApiCsrf()` prüfen
- **Interne Datei erreichbar** → Direct-Access-Guard + Webserver-Regeln prüfen

---

## Wichtiger Sicherheitshinweis

Führe diese Tests nur gegen Systeme aus, für die du eine ausdrückliche Erlaubnis hast.
